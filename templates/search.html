<!-- templates/home.html -->
{% extends "base.html" %}

<!-- Override the title block from base.html -->
{% block title %}{{ title }}{% endblock %}

<!-- Override the content block from base.html -->
{% block content %}
 
 
 <!-- NEW: 검색 결과 데이터 -->
    <div class="mb-8 bg-white p-6 rounded-lg shadow-lg">
        <form id="search-form" action="/search/" method="get">
            <div class="flex items-center space-x-4">
                <input type="number" id="search-input" name="key" placeholder="안건 번호로 결과 찾기 (e.g. 1104)" required
                       class="block w-full px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button type="submit"
                        class="px-6 py-2 bg-gray-800 text-white font-semibold rounded-lg shadow-md hover:bg-gray-900 transition-colors whitespace-nowrap">
                    검색
                </button>
            </div>
        </form>
        
        <!-- Div to display search results -->
        {% for d in data %}
            <p class="mt-10 text-left text-black-500">{% if d[0] == 'ver1' %}R1.0 {%else%}R2.0{%endif%}</p>
            {% if d[1] %}
            <button onclick="copyTableData()" class="mb-4 px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                결과 복사하기
            </button>
            <div class="mb-8 bg-white p-6 rounded-lg overflow-x-auto">
                <table class="text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400 border-collapse border border-gray-400 overflow-x-auto" style="table-layout: fixed;">
                    <thead class="text-xs text-black uppercase bg-gray-50 dark:bg-gray-700 dark:text-grey-100">
                        <tr>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">안건상정자</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">번호</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">송신/수신</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">추가/삭제</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400" style="width: 100px; word-break: keep-all;">수신제어기</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">송신제어기</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">메시지</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">시그널</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">버전</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">STD/OPT</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">결과</td>
                            <td class="px-6 py-4 bg-gray-100 border border-gray-400">사전검토결과</td>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in d[1] %}
                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-400">
                            <!-- 옵션 1. 사용중. 셀의 색 없이 데이터만 추출할 경우 -->
                            {% for cell in row[:13] %}
                            {% if loop.index0 != 2 %}
                                {% if loop.index0 == 3 %}
                                    <!-- TODO: 이거 색 맞는지 살펴보기 ㅌ-->
                                    {% if cell == "송신" %} <td class="px-6 py-4 bg-blue-100 border border-gray-400">{{ cell }}</td>
                                    {% elif cell == "수신" %} <td class="px-6 py-4 bg-yellow-100 border border-gray-400">{{ cell }}</td>
                                    {% else %} <td class="px-6 py-4 bg-green-100 border border-gray-400">{{ cell }}</td>
                                    {% endif %}
                                {% elif loop.index0 == 11 %}
                                    {% if cell == "반영" %} <td class="px-6 py-4 bg-green-100 border border-gray-400">{{ cell }}</td>
                                    {% elif cell == "기반영" %} <td class="px-6 py-4 bg-white border border-gray-400">{{ cell }}</td>
                                    {% else %} <td class="px-6 py-4 bg-red-100 border border-gray-400">{{ cell }}</td>
                                    {% endif %}
                                {% else %}
                                <td class="px-6 py-4 border border-gray-400">{{ cell }}</td>
                                {% endif %}
                            {% endif %}
                            {% endfor %}
                            <!-- 옵션 2. 셀의 색을 함께 추출할 경우
                            {% for i in range(row['cells']|length) %}
                            <td class="px-6 py-4" style="{{ row['styles'][i] }}">{{ row['cells'][i] }}</td>
                            {% endfor %}
                            -->
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
                <p class="text-center text-gray-500">{{key}} 데이터 없음</p>
            {% endif %}
        {% endfor %}
    
    </div>

<script>
function copyTableData() {
    const tables = document.querySelectorAll('table');
    if (tables.length === 0) {
        alert('복사할 표가 없습니다.');
        return;
    }

    let htmlContent = '<table border="1" cellpadding="5" cellspacing="0">';
    let textContent = '';

    tables.forEach((table, tableIndex) => {
        // 헤더 행 처리
        const headerRow = table.querySelector('thead tr');
        if (headerRow) {
            htmlContent += '<thead><tr>';
            const headerCells = Array.from(headerRow.querySelectorAll('td'));
            // 첫 번째, 두 번째 열을 제외하고 3번째부터 복사
            const headerData = [];
            headerCells.slice(2).forEach(cell => {
                const text = cell.textContent.trim();
                const bgColor = window.getComputedStyle(cell).backgroundColor;
                htmlContent += `<td style="background-color: ${bgColor}; border: 1px solid #000;">${text}</td>`;
                headerData.push(text);
            });
            htmlContent += '</tr></thead>';
            textContent += headerData.join('\t') + '\n';
        }

        // 데이터 행 처리
        htmlContent += '<tbody>';
        const bodyRows = table.querySelectorAll('tbody tr');
        bodyRows.forEach(row => {
            htmlContent += '<tr>';
            const cells = Array.from(row.querySelectorAll('td'));
            const rowData = [];
            // 첫 번째, 두 번째 열을 제외하고 3번째부터 복사
            cells.slice(2).forEach(cell => {
                const text = cell.textContent.trim();
                const bgColor = window.getComputedStyle(cell).backgroundColor;
                htmlContent += `<td style="background-color: ${bgColor}; border: 1px solid #000;">${text}</td>`;
                rowData.push(text);
            });
            htmlContent += '</tr>';
            textContent += rowData.join('\t') + '\n';
        });
        htmlContent += '</tbody>';

        // 여러 테이블이 있을 경우 구분
        if (tableIndex < tables.length - 1) {
            textContent += '\n';
        }
    });

    htmlContent += '</table>';

    // ClipboardItem을 사용하여 HTML과 텍스트 모두 클립보드에 복사
    const blob = new Blob([htmlContent], { type: 'text/html' });
    const textBlob = new Blob([textContent], { type: 'text/plain' });

    const clipboardItem = new ClipboardItem({
        'text/html': blob,
        'text/plain': textBlob
    });

    navigator.clipboard.write([clipboardItem]).then(() => {
        alert('표 형식이 클립보드에 복사되었습니다! (3번째 열부터)');
    }).catch(err => {
        console.error('복사 실패:', err);
        alert('복사에 실패했습니다. 브라우저 권한을 확인해주세요.');
    });
}
</script>

{% endblock %}


<!--
https://inpa.tistory.com/entry/CSS-%F0%9F%92%8D-%ED%85%8C%EC%9D%B4%EB%B8%94table-%EB%94%94%EC%9E%90%EC%9D%B8-%F0%9F%96%8C%EF%B8%8F-%EB%AA%A8%EC%9D%8C

        <p> search page 2 </p>
        <div id="search-results-container" class="mt-6 hidden">
            <h3 class="text-xl font-semibold mb-2">결과:</h3>
            <pre id="search-results" class="bg-gray-900 text-white p-4 rounded-lg text-sm overflow-x-auto"></pre>
        </div>

-->